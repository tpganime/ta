<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fusion Hub – Home with FusionBot</title>
  <style>
    :root { 
      --bg-start: #aeecdb; 
      --bg-end: #d0f5ea; 
      --item-bg: rgba(255,255,255,0.95); 
      --shadow: rgba(0,0,0,0.15); 
      --hover: rgba(0,0,0,0.25); 
    }

    body { 
      font-family: Arial, sans-serif; 
      background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
      padding: 20px;
      min-height: 100vh;
      margin: 0;
    }

    .container { 
      max-width: 800px;
      margin: 0 auto;
      padding-bottom: 150px; /* Space for chat */
    }

    .app-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
      gap: 18px; 
      margin: 30px auto;
    }

    .app-item { 
      background: var(--item-bg); 
      border-radius: 10px; 
      padding: 15px; 
      text-align: center; 
      box-shadow: 0 3px 8px var(--shadow); 
      cursor: pointer; 
      transition: transform .35s, box-shadow .35s; 
    }

    .app-item:hover { 
      transform: scale(1.02); 
      box-shadow: 0 6px 16px var(--hover); 
    }

    .app-item img { 
      width: 55px; 
      height: 55px; 
      margin-bottom: 8px; 
      object-fit: contain;
    }

    #fusionBot { 
      position: fixed; 
      bottom: 100px; 
      right: 20px; 
      width: 100px; 
      height: 100px; 
      background: #ffffffcc; 
      border-radius: 50%; 
      box-shadow: 0 3px 8px rgba(0,0,0,0.3); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      z-index: 1000;
    }

    #fusionBot img { 
      width: 80px; 
      height: 80px; 
    }

    #speechBubble { 
      position: fixed; 
      bottom: 210px; 
      right: 130px; 
      max-width: 250px; 
      padding: 15px; 
      background: #fff; 
      border-radius: 15px; 
      box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
      font-size: 14px; 
      opacity: 0; 
      transition: opacity 0.3s; 
      z-index: 999;
    }

    #speechBubble.active { 
      opacity: 1; 
    }

    #chatPanel {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: calc(100% - 40px);
      max-width: 600px;
      display: flex;
      gap: 8px;
      z-index: 1001;
    }

    #chatInput {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #ccc;
      border-radius: 25px;
      font-size: 16px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    #chatInput:focus {
      border-color: #4CAF50;
      box-shadow: 0 2px 8px rgba(76,175,80,0.3);
    }

    #sendBtn {
      padding: 12px 20px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: background 0.3s, transform 0.1s;
    }

    #sendBtn:hover {
      background: #45a049;
    }

    #sendBtn:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Welcome to Fusion Hub!</h1>
    <p>Say "hey TPG", "TPG", or "FusionHub" to wake FusionBot!</p>
    <div class="app-grid">
      <div class="app-item" onclick="window.open('https://chat.openai.com/', '_blank')">
        <img src="gpt.png" alt="ChatGPT">
        <span>ChatGPT</span>
      </div>
      <div class="app-item" onclick="window.open('https://soundcloud.com/', '_blank')">
        <img src="music.png" alt="Music">
        <span>Music</span>
      </div>
      <div class="app-item" onclick="window.open('https://crazygames.com/', '_blank')">
        <img src="games.jpg" alt="Games">
        <span>Game Server 1</span>
      </div>
      <div class="app-item" onclick="window.open('https://poki.com/', '_blank')">
        <img src="games.jpg" alt="Games">
        <span>Game Server 2</span>
      </div>
      <div class="app-item" onclick="window.open('https://aniplaynow.live/', '_blank')">
        <img src="anime.png" alt="Anime">
        <span>Anime</span>
      </div>
    </div>
  </div>

  <div id="fusionBot">
    <img src="ai.gif" alt="FusionBot AI Assistant">
  </div>
  
  <div id="speechBubble"></div>

  <div id="chatPanel">
    <input type="text" id="chatInput" placeholder="Type your message...">
    <button id="sendBtn">Send</button>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const bubble = document.getElementById('speechBubble');
      const chatInput = document.getElementById('chatInput');
      const sendBtn = document.getElementById('sendBtn');

      if (!bubble || !chatInput || !sendBtn) {
        console.error('One or more DOM elements not found:', { bubble, chatInput, sendBtn });
        return;
      }

      // Preloaded 20 jokes
      const jokes = [
        "Why don’t skeletons fight each other? Because they don’t have the guts!",
        "What do you call fake spaghetti? An impasta!",
        "Why did the scarecrow win an award? Because he was outstanding in his field!",
        "What do you call a bear with no teeth? A gummy bear!",
        "Why don’t eggs tell jokes? They’d crack up!",
        "What do you call cheese that isn’t yours? Nacho cheese!",
        "Why did the tomato turn red? Because it saw the salad dressing!",
        "What do you call a lazy kangaroo? A pouch potato!",
        "Why did the bicycle fall over? Because it was two-tired!",
        "What do you call a fish with no eyes? A fsh!",
        "Why did the banana go to the doctor? It wasn’t peeling well!",
        "What do you call a snowman with a six-pack? An abdominal snowman!",
        "Why did the math book look sad? Because it had too many problems!",
        "What do you call a cow with no legs? Ground beef!",
        "Why did the chicken join a band? Because it had the drumsticks!",
        "What do you call a dog that can do magic? A labracadabrador!",
        "Why did the golfer bring two pairs of pants? In case he got a hole in one!",
        "What do you call a pig that does karate? A pork chop!",
        "Why did the cookie go to the doctor? It felt crummy!",
        "What do you call an alligator in a vest? An investi-gator!"
      ];

      // Preloaded facts
      const facts = [
        "The shortest war in history lasted 38 minutes.",
        "Honey never spoils; archaeologists found edible honey in ancient Egyptian tombs!",
        "Octopuses have three hearts.",
        "The Eiffel Tower can be 15 cm taller in summer due to thermal expansion.",
        "A group of flamingos is called a 'flamboyance'."
      ];

      // State to track conversation
      let userName = localStorage.getItem('userName');
      let isFirstMessage = !userName;
      let isSettingUp = false;
      let expectingFollowUp = false; // Track if awaiting a response to "How about you?"
      let isWakeWordDetected = false; // Track if wake word is detected

      function showBubble(text) {
        if (!bubble) {
          console.error('speechBubble element not found');
          return;
        }
        bubble.textContent = text;
        bubble.classList.add('active');
        setTimeout(() => bubble.classList.remove('active'), 5000); // 5 seconds
        console.log('Displayed:', text); // Debugging
      }

      // Current time and date function with season and day type
      function getIndiaTime() {
        const now = new Date('2025-04-30T23:03:00+05:30');
        const options = {
          timeZone: 'Asia/Kolkata',
          weekday: 'long',
          month: 'long',
          day: 'numeric',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          hour12: true
        };
        const dateString = now.toLocaleString('en-US', options);
        const dayOfWeek = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
        const month = now.getMonth(); // 0 = January, 1 = February, etc.
        const dayType = (dayOfWeek === 0 || dayOfWeek === 6) ? 'a weekend' : 'a weekday';
        const season = (month >= 2 && month <= 4) ? 'spring' : (month >= 5 && month <= 7) ? 'summer' : (month >= 8 && month <= 10) ? 'autumn' : 'winter';
        return `${dateString}, ${dayType} in the ${season} season.`;
      }

      function getRandomJoke() {
        const randomIndex = Math.floor(Math.random() * jokes.length);
        return jokes[randomIndex];
      }

      function getRandomFact() {
        const randomIndex = Math.floor(Math.random() * facts.length);
        return facts[randomIndex];
      }

      function handleCommand(input) {
        const lowerInput = input.toLowerCase().trim();

        // Handle first message setup
        if (isFirstMessage) {
          isFirstMessage = false;
          isSettingUp = true;
          return "Please enter your name:";
        }

        // Handle setup mode
        if (isSettingUp) {
          if (input) {
            userName = input;
            localStorage.setItem('userName', userName);
            isSettingUp = false;
            return `Name set to ${userName}! Welcome to FusionBot! Say "hey TPG", "TPG", or "FusionHub" to start, or type 'help' for commands.`;
          } else {
            return "Please enter a valid name:";
          }
        }

        // Handle follow-up to "How are you?"
        if (expectingFollowUp) {
          expectingFollowUp = false;
          const positiveReplies = ["good", "great", "fine", "awesome", "happy", "excellent"];
          const negativeReplies = ["bad", "not good", "sad", "terrible", "upset", "poor"];
          if (positiveReplies.some(word => lowerInput.includes(word))) {
            return `Glad to hear that, ${userName}! I'm doing great too! Want to hear a fact?`;
          } else if (negativeReplies.some(word => lowerInput.includes(word))) {
            return `Sorry to hear that, ${userName}! Hope you feel better soon! Would you like a joke to cheer you up?`;
          } else {
            return `Thanks for sharing, ${userName}! I'm doing great! How can I assist you today?`;
          }
        }

        // Handle time-related queries
        const timeKeywords = ["time", "tell me time", "what's the time", "time please", "current time", "what time is it"];
        if (timeKeywords.some(keyword => lowerInput.includes(keyword))) {
          const currentTime = getIndiaTime();
          return `Here’s the details: ${currentTime}`;
        }

        // Handle weather query (static knowledge for April 30, 2025, in India)
        if (lowerInput.includes("weather")) {
          return `For April 30, 2025, in India, expect warm spring weather, around 30-35°C in most regions, with possible evening showers in the north. Stay hydrated!`;
        }

        // Handle fact query
        if (lowerInput.includes("fact")) {
          return getRandomFact();
        }

        // Handle greetings
        if (lowerInput === "hello" || lowerInput === "hi" || lowerInput === "hey") {
          const hour = new Date('2025-04-30T23:03:00+05:30').getHours();
          const greeting = hour >= 5 && hour < 12 ? "Good morning" : hour >= 12 && hour < 17 ? "Good afternoon" : "Good evening";
          return `${greeting}, ${userName}! Nice to see you! How can I help today?`;
        } else if (lowerInput === "how are you") {
          expectingFollowUp = true; // Set flag to expect a follow-up
          return `I'm doing great, ${userName}! How about you?`;
        } else if (lowerInput === "joke") {
          return getRandomJoke();
        } else if (lowerInput === "help") {
          return "Available commands: hello/hi/hey, how are you, time/tell me time/what's the time/time please/what time is it, weather, fact, joke, help, open [chatgpt/music/game server 1/game server 2/anime]";
        } else if (lowerInput.startsWith("open ")) {
          const link = lowerInput.replace("open ", "").toLowerCase();
          const urls = {
            "chatgpt": "https://chat.openai.com/",
            "music": "https://soundcloud.com/",
            "game server 1": "https://crazygames.com/",
            "game server 2": "https://poki.com/",
            "anime": "https://crunchyroll.com/"
          };
          if (urls[link]) {
            window.open(urls[link], '_blank');
            return `Opening ${link}...`;
          } else {
            return "Invalid link. Try: chatgpt, music, game server 1, game server 2, anime.";
          }
        } else {
          return `You said: ${input}. I can respond to: hello/hi/hey, how are you, time/tell me time/what's the time/time please/what time is it, weather, fact, joke, help, or open [link].`;
        }
      }

      async function sendMessage() {
        const message = chatInput.value.trim();
        if (!message) {
          showBubble("Please type a message.");
          return;
        }
        
        chatInput.value = '';
        showBubble('Thinking...');

        const response = handleCommand(message);
        showBubble(response);
      }

      // Voice recognition setup
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      let recognition;
      if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
        recognition.continuous = true; // Enable continuous listening

        let lastResult = ''; // Store the last recognized phrase

        recognition.onresult = (event) => {
          const currentResult = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
          lastResult = currentResult;
          console.log('Recognized:', currentResult); // Debugging

          if (!isWakeWordDetected) {
            showBubble('Listening...');
          }

          // Check for wake words
          const wakeWords = ["hey tpg", "tpg", "fusionhub"];
          if (wakeWords.some(word => lastResult.includes(word))) {
            isWakeWordDetected = true;
            showBubble('Wake word detected! Waiting for your command...');
            return; // Wait for the next command after wake word
          }

          // Process command only if wake word was detected previously
          if (isWakeWordDetected && lastResult && !wakeWords.some(word => lastResult.includes(word))) {
            chatInput.value = lastResult;
            showBubble('Thinking...');
            const response = handleCommand(lastResult);
            showBubble(response);
            isWakeWordDetected = false; // Reset after processing command
          }
        };

        recognition.onerror = (event) => {
          showBubble('Error: Could not recognize speech. Please check your microphone or try typing.');
          console.error('Speech recognition error:', event.error); // Debugging
          recognition.start(); // Restart listening
        };

        recognition.onend = () => {
          console.log('Recognition ended, restarting...'); // Debugging
          recognition.start(); // Always restart listening
        };

        // Start voice listening automatically
        try {
          recognition.start();
          showBubble('Listening...');
          console.log('Recognition started'); // Debugging
        } catch (e) {
          showBubble('Error: Failed to start recognition. Please check browser permissions.');
          console.error('Start error:', e); // Debugging
        }
      } else {
        showBubble('Speech recognition not supported in this browser. Please type your message.');
        console.warn('Speech recognition not supported'); // Debugging
      }

      // Event Listeners for text input
      sendBtn.addEventListener('click', sendMessage);
      chatInput.addEventListener('keypress', e => {
        if (e.key === 'Enter') sendMessage();
      });

      // Initial welcome if name is already set
      if (userName) {
        setTimeout(() => showBubble(`Welcome back, ${userName}! Say "hey TPG", "TPG", or "FusionHub" to start, or type 'help' for commands.`), 1000);
      }
    });
  </script>
</body>
</html>
